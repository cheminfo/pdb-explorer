// jcampconverter@v2.0.8, MIT licensed. https://github.com/cheminfo/jcampconverter
!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var t;"undefined"!=typeof window?t=window:"undefined"!=typeof global?t=global:"undefined"!=typeof self&&(t=self),t.JcampConverter=e()}}(function(){return function e(t,r,a){function n(s,o){if(!r[s]){if(!t[s]){var l="function"==typeof require&&require;if(!o&&l)return l(s,!0);if(i)return i(s,!0);var f=new Error("Cannot find module '"+s+"'");throw f.code="MODULE_NOT_FOUND",f}var p=r[s]={exports:{}};t[s][0].call(p.exports,function(e){var r=t[s][1][e];return n(r?r:e)},p,p.exports,e,t,r,a)}return r[s].exports}for(var i="function"==typeof require&&require,s=0;s<a.length;s++)n(a[s]);return n}({1:[function(e,t){"use strict";function r(){function e(e){for(var t=e.length,r=new Array(t),a=0;t>a;a++)r[a]=parseFloat(e[a]);return r}function t(t,l){l=l||{};var p=/^[A-Z]+$/;l.keepRecordsRegExp&&(p=l.keepRecordsRegExp);var u,c,g,d,h,v,F,m,y,X=new Date,x={},A={};A.profiling=[],A.logs=[];var b=[];A.spectra=b,A.info={};var T={};if("string"!=typeof t)return A;for(A.profiling&&A.profiling.push({action:"Before split to LDRS",time:new Date-X}),d=t.split(/[\r\n]+##/),A.profiling&&A.profiling.push({action:"Split to LDRS",time:new Date-X}),d[0]&&(d[0]=d[0].replace(/^[\r\n ]*##/,"")),h=0,v=d.length;v>h;h++){if(u=d[h],F=u.indexOf("="),F>0?(c=u.substring(0,F),g=u.substring(F+1).trim()):(c=u,g=""),c=c.replace(/[_ -]/g,"").toUpperCase(),"DATATABLE"==c&&(m=g.indexOf("\n"),-1==m&&(m=g.indexOf("\r")),m>0)){var O=-1,E=-1;if(y=g.substring(0,m).split(/[ ,;\t]{2,}/),y[0].indexOf("++")>0){var C=y[0].replace(/.*\(([a-zA-Z0-9]+)\+\+.*/,"$1"),S=y[0].replace(/.*\.\.([a-zA-Z0-9]+).*/,"$1");O=x.symbol.indexOf(C),E=x.symbol.indexOf(S)}-1==O&&(O=0),-1==E&&(E=0),x.first&&(x.first.length>O&&(T.firstX=x.first[O]),x.first.length>E&&(T.firstY=x.first[E])),x.last&&(x.last.length>O&&(T.lastX=x.last[O]),x.last.length>E&&(T.lastY=x.last[E])),x.vardim&&x.vardim.length>O&&(T.nbPoints=x.vardim[O]),x.factor&&(x.factor.length>O&&(T.xFactor=x.factor[O]),x.factor.length>E&&(T.yFactor=x.factor[E])),x.units&&(x.units.length>O&&(T.xUnit=x.units[O]),x.units.length>E&&(T.yUnit=x.units[E])),T.datatable=y[0],y[1]&&y[1].indexOf("PEAKS")>-1?c="PEAKTABLE":y[1]&&(y[1].indexOf("XYDATA")||y[0].indexOf("++")>0)&&(c="XYDATA",T.deltaX=(T.lastX-T.firstX)/(T.nbPoints-1))}if("TITLE"==c)T.title=g;else if("DATATYPE"==c)T.dataType=g,g.indexOf("nD")>-1&&(A.twoD=!0);else if("XUNITS"==c)T.xUnit=g;else if("YUNITS"==c)T.yUnit=g;else if("FIRSTX"==c)T.firstX=parseFloat(g);else if("LASTX"==c)T.lastX=parseFloat(g);else if("FIRSTY"==c)T.firstY=parseFloat(g);else if("NPOINTS"==c)T.nbPoints=parseFloat(g);else if("XFACTOR"==c)T.xFactor=parseFloat(g);else if("YFACTOR"==c)T.yFactor=parseFloat(g);else if("DELTAX"==c)T.deltaX=parseFloat(g);else if(".OBSERVEFREQUENCY"==c||"$SFO1"==c)T.observeFrequency||(T.observeFrequency=parseFloat(g));else if(".OBSERVENUCLEUS"==c)T.xType||(A.xType=g.replace(/[^a-zA-Z0-9]/g,""));else if("$SFO2"==c)A.indirectFrequency||(A.indirectFrequency=parseFloat(g));else if("$OFFSET"==c)A.shiftOffsetNum=0,A.shiftOffsetVal||(A.shiftOffsetVal=parseFloat(g));else if("$REFERENCEPOINT"==c);else if("VARNAME"==c)x.varname=g.split(/[, \t]{2,}/);else if("SYMBOL"==c)x.symbol=g.split(/[, \t]{2,}/);else if("VARTYPE"==c)x.vartype=g.split(/[, \t]{2,}/);else if("VARFORM"==c)x.varform=g.split(/[, \t]{2,}/);else if("VARDIM"==c)x.vardim=e(g.split(/[, \t]{2,}/));else if("UNITS"==c)x.units=g.split(/[, \t]{2,}/);else if("FACTOR"==c)x.factor=e(g.split(/[, \t]{2,}/));else if("FIRST"==c)x.first=e(g.split(/[, \t]{2,}/));else if("LAST"==c)x.last=e(g.split(/[, \t]{2,}/));else if("MIN"==c)x.min=e(g.split(/[, \t]{2,}/));else if("MAX"==c)x.max=e(g.split(/[, \t]{2,}/));else if(".NUCLEUS"==c)A.twoD&&(A.yType=g.split(/[, \t]{2,}/)[0]);else if("PAGE"==c){T.page=g.trim(),T.pageValue=parseFloat(g.replace(/^.*=/,"")),T.pageSymbol=T.page.replace(/=.*/,"");var R=x.symbol.indexOf(T.pageSymbol),w="";x.units&&x.units[R]&&(w=x.units[R]),A.indirectFrequency&&"PPM"!=w&&(T.pageValue/=A.indirectFrequency)}else"RETENTIONTIME"==c?T.pageValue=parseFloat(g):"XYDATA"==c?(i(A,T),g.match(/.*\+\+.*/)?o(T,g,A):s(T,g,A),b.push(T),T={}):"PEAKTABLE"==c?(i(A,T),s(T,g,A),b.push(T),T={}):a(c)?T[r(c)]=g:c.match(p)&&(A.info[c]=g.trim())}if(A.profiling&&A.profiling.push({action:"Finished parsing",time:new Date-X}),Object.keys(x).length>0){for(var U=[],D=Object.keys(x),h=0;h<D.length;h++)for(var Y=D[h],L=x[Y],P=0;P<L.length;P++)U[P]||(U[P]={}),U[P][Y]=L[P];A.ntuples=U}if(A.twoD&&(f(A),A.profiling&&A.profiling.push({action:"Finished countour plot calculation",time:new Date-X}),l.keepSpectra||delete A.spectra),b.length>1&&b[0].dataType&&b[0].dataType.toLowerCase().match(/.*mass./)&&(n(A),A.profiling&&A.profiling.push({action:"Finished GCMS calculation",time:new Date-X})),l.xy&&b.length>0)for(var h=0;h<b.length;h++){var T=b[h];if(T.data.length>0)for(var P=0;P<T.data.length;P++){for(var M=T.data[P],N={x:Array(M.length/2),y:Array(M.length/2)},V=0;V<M.length;V+=2)N.x[V/2]=M[V],N.y[V/2]=M[V+1];T.data[P]=N}}return A.profiling&&A.profiling.push({action:"Total time",time:new Date-X}),A}function r(e){return e.toLowerCase().replace(/[^a-z0-9]/g,"")}function a(e){for(var t=0;t<h.length;t++)if(e==h[t])return!0;return!1}function n(e){var t,a=e.spectra,n=[];for(t=0;t<h.length;t++){var i=r(h[t]);a[0][i]&&n.push(i)}var s={};for(s.gc={},s.ms=[],t=0;t<n.length;t++)s.gc[n[t]]=[];for(t=0;t<a.length;t++){for(var o=a[t],l=0;l<n.length;l++)s.gc[n[l]].push(o.pageValue),s.gc[n[l]].push(parseFloat(o[n[l]]));o.data&&(s.ms[t]=o.data[0])}e.gcms=s}function i(e,t){if(t.xFactor||(t.xFactor=1),t.yFactor||(t.yFactor=1),t.observeFrequency&&t.xUnit&&"HZ"==t.xUnit.toUpperCase()&&(t.xUnit="PPM",t.xFactor=t.xFactor/t.observeFrequency,t.firstX=t.firstX/t.observeFrequency,t.lastX=t.lastX/t.observeFrequency,t.deltaX=t.deltaX/t.observeFrequency),e.shiftOffsetVal){var r=t.firstX-e.shiftOffsetVal;t.firstX=t.firstX-r,t.lastX=t.lastX-r}}function s(e,t,r){e.isPeaktable=!0;var a,n,i,s,o,l=[];e.data=[l];var f=t.split(/,? *,?[;\r\n]+ */),p=0;for(a=1,n=f.length;n>a;a++)if(o=f[a].trim().replace(c,"").split(g),o.length%2==0)for(i=0,s=o.length;s>i;i+=2)l[p++]=parseFloat(o[i])*e.xFactor,l[p++]=parseFloat(o[i+1])*e.yFactor;else r.logs.push("Format error: "+o)}function o(e,t,r){e.deltaX||(e.deltaX=(e.lastX-e.firstX)/(e.nbPoints-1)),e.isXYdata=!0;var a=[];e.data=[a];var n,i,s,o=e.firstX,l=e.firstY,f=t.split(/[\r\n]+/);i=[];for(var p=1,g=f.length;g>p;p++)if(i=f[p].trim().replace(c,"").split(u),i.length>0){if(d){e.firstPoint||(e.firstPoint=parseFloat(i[0]));var h=parseFloat(i[0]-e.firstPoint)*e.xFactor+e.firstX;(n||0==n)&&(h+=e.deltaX),r.logs.push("Checking X value: currentX: "+o+" - expectedCurrentX: "+h)}for(var v=1,F=i.length;F>v;v++)if(1!=v||!n&&0!=n){if(i[v].length>0)if(s=i[v].charCodeAt(0),43==s||45==s||46==s||s>47&&58>s)n=null,l=parseFloat(i[v]),a.push(o,l*e.yFactor),o+=e.deltaX;else if(s>63&&74>s)n=null,l=parseFloat(String.fromCharCode(s-16)+i[v].substring(1)),a.push(o,l*e.yFactor),o+=e.deltaX;else if(s>96&&106>s)n=null,l=-parseFloat(String.fromCharCode(s-48)+i[v].substring(1)),a.push(o,l*e.yFactor),o+=e.deltaX;else if(s>82&&91>s||115==s){var m=parseFloat(String.fromCharCode(s-34)+i[v].substring(1))-1;115==s&&(m=parseFloat("9"+i[v].substring(1))-1);for(var y=0;m>y;y++)n&&(l+=n),a.push(o,l*e.yFactor),o+=e.deltaX}else 37==s?(n=parseFloat("0"+i[v].substring(1)),l+=n,a.push(o,l*e.yFactor),o+=e.deltaX):s>73&&83>s?(n=parseFloat(String.fromCharCode(s-25)+i[v].substring(1)),l+=n,a.push(o,l*e.yFactor),o+=e.deltaX):s>105&&115>s&&(n=-parseFloat(String.fromCharCode(s-57)+i[v].substring(1)),l+=n,a.push(o,l*e.yFactor),o+=e.deltaX)}else n=null,s=i[v].charCodeAt(0)}}function l(e){for(var t=0,r=e[0].data[0][0],a=r,n=e.length,i=e[0].data[0].length/2,s=new Array(n),o=0;n>o;o++){s[o]=new Array(i);for(var l=0;i>l;l++)s[o][l]=e[o].data[0][2*l+1],s[o][l]<r&&(r=e[o].data[0][2*l+1]),s[o][l]>a&&(a=e[o].data[0][2*l+1]),0!=o&&0!=l&&(t+=Math.abs(s[o][l]-s[o][l-1])+Math.abs(s[o][l]-s[o-1][l]))}return{z:s,minX:e[0].data[0][0],maxX:e[0].data[0][e[0].data[0].length-2],minY:e[0].pageValue,maxY:e[n-1].pageValue,minZ:r,maxZ:a,noise:t/((n-1)*(i-1)*2)}}function f(e){var t=l(e.spectra);e.contourLines=p(t),delete t.z,e.minMax=t}function p(e){for(var t,r,a,n,i,s=e.noise,o=e.z,l=[],f=7,p=new Float32Array(4),u=[],c=o.length,g=o[0].length,d=e.minX,h=e.maxX,v=(h-d)/(g-1),F=e.minY,m=e.maxY,y=(m-F)/(c-1),X=e.minZ,x=e.maxZ,A=0;2*f>A;A++){var b={};l.push(b);var T=A%2;i=0==T?(x-5*s)*Math.exp(A/2-f)+5*s:-(x-5*s)*Math.exp(A/2-f)-5*s;var O=[];if(b.zValue=i,b.lines=O,!(X>=i||i>=x))for(var E=0;c-1>E;E++)for(var C=0;g-1>C;C++){p[0]=o[E][C],p[1]=o[E][C+1],p[2]=o[E+1][C],p[3]=o[E+1][C+1];for(var S=0;4>S;S++)u[S]=p[S]>i;u[0]!=u[1]&&u[0]!=u[2]&&(t=C+(i-p[0])/(p[1]-p[0]),r=E,a=C,n=E+(i-p[0])/(p[2]-p[0]),O.push(t*v+d,r*y+F,a*v+d,n*y+F)),u[3]!=u[1]&&u[3]!=u[2]&&(t=C+1,r=E+1-(i-p[3])/(p[1]-p[3]),a=C+1-(i-p[3])/(p[2]-p[3]),n=E+1,O.push(t*v+d,r*y+F,a*v+d,n*y+F)),u[1]!=u[2]&&(t=C+1-(i-p[1])/(p[2]-p[1]),r=E+(i-p[1])/(p[2]-p[1]),u[1]!=u[0]&&(a=C+1-(i-p[1])/(p[0]-p[1]),n=E,O.push(t*v+d,r*y+F,a*v+d,n*y+F)),u[2]!=u[0]&&(a=C,n=E+1-(i-p[2])/(p[0]-p[2]),O.push(t*v+d,r*y+F,a*v+d,n*y+F)),u[1]!=u[3]&&(a=C+1,n=E+(i-p[1])/(p[3]-p[1]),O.push(t*v+d,r*y+F,a*v+d,n*y+F)),u[2]!=u[3]&&(a=C+(i-p[2])/(p[3]-p[2]),n=E+1,O.push(t*v+d,r*y+F,a*v+d,n*y+F)))}}return{minX:e.minX,maxX:e.maxX,minY:e.minY,maxY:e.maxY,segments:l}}var u=/[,\t \+-]*(?=[^\d,\t \.])|[ \t]+(?=[\d+\.-])/,c=/\$\$.*/,g=/[,\t ]+/,d=!1,h=["TIC",".RIC","SCANNUMBER"];return t}function a(e,t,r){return"boolean"==typeof t&&(r=t,t={}),r?n(e,t):o(e,t)}function n(e,t){return s||i(),new Promise(function(r){var a=Date.now()+""+Math.random();l[a]=r,s.postMessage({stamp:a,input:e,options:t})})}function i(){var e=URL.createObjectURL(new Blob(["var getConverter ="+r.toString()+";var convert = getConverter(); onmessage = function (event) { postMessage({stamp: event.data.stamp, output: convert(event.data.input, event.data.options)}); };"],{type:"application/javascript"}));s=new Worker(e),URL.revokeObjectURL(e),s.addEventListener("message",function(e){var t=e.data.stamp;l[t]&&l[t](e.data.output)})}var s,o=r(),l={};t.exports={convert:a}},{}]},{},[1])(1)});
//# sourceMappingURL=jcampconverter.min.js.map