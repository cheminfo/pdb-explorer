"use strict";define(["modules/default/defaultview","src/util/datatraversing","src/util/api","src/util/util","lib/dhtmlxchart/dhtmlxchart"],function(a,b,c,d){function e(){}return $.extend(!0,e.prototype,a,{init:function(){this.dom||(this._id=d.getNextUniqueId(),this.dom=$('<div style="height: 100%;width: 100%" id="'+this._id+'"></div>'),this.module.getDomContent().html(this.dom)),this._data=[],this.resolveReady()},onResize:function(){this._redraw()},update:{chart:function(a){this.value=a.get(),this._redraw()}},_redraw:function(){if(this.value){this.dom&&this.dom.empty();var a=this._convertChartToData(this.value);this.createChart(this.value),this._radar.parse(a,"json");var b=this;this._radar.attachEvent("onMouseMove",function(c,d,e){return a.forEach(function(a){if(a.id==c){var e=a;"d"==d.toElement.outerHTML[d.toElement.outerHTML.length-3]?b.module.controller.elementHover(e._highlight[0]):b.module.controller.elementHover(e._highlight[d.toElement.outerHTML[d.toElement.outerHTML.length-3]])}}),!0}),this._radar.attachEvent("onMouseOut",function(a,c,d){b.module.controller.elementOut()})}},_convertChartToData:function(a){var b=[];if(a&&Array.isArray(a.data))for(var c=0;c<a.data[0].x.length;c++){b[c]={},b[c].xunit=a.data[0].x[c],b[c]._highlight=[];for(var d=0;d<a.data.length;d++){var e="serie"+d;b[c][e]=a.data[d].y[c],a.data[d]._highlight&&a.data[d]._highlight[c]&&b[c]._highlight.push({name:e,_highlight:a.data[d]._highlight[c]})}}return b},getRandomColor:function(a,b){var c=360/a*b,d="hsla("+c+",100%,50%,0.3)";return d},createChart:function(a,b){var c=$.proxy(this.module.getConfiguration,this.module);switch(c("preference")){case"radar":a.data[0].color||(a.data[0].color=this.getRandomColor(a.data.length,0));var d={view:"radar",container:this._id,alpha:.2,value:"#serie0#",disableLines:c("line"),disableItems:c("point"),color:a.data[0].color,fill:a.data[0].color,line:{color:a.data[0].color,width:1},xAxis:{template:"#xunit#"},yAxis:{lineShape:c("lineshape"),start:c("start"),end:c("end"),step:c("step")}};this._radar=new dhtmlXChart(d);for(var e=[],f=0;f<a.data.length;f++)0!=f&&(a.data[f].color||(a.data[f].color=this.getRandomColor(a.data.length,f)),this._radar.addSeries({value:"#serie"+f+"#",fill:a.data[f].color,disableLines:c("line"),line:{color:a.data[f].color,width:1}})),e.push({text:a.data[f].serieLabel,color:a.data[f].color});break;case"pie":var d={view:c("pie"),container:this._id,radius:220,value:"#serie0#",color:a.data[0].color,pieInnerText:"<b>#xunit#</b>"};this._radar=new dhtmlXChart(d)}if("true"==c("showlegend"))switch(c("legendalign")){case"top-left":this._radar.define("legend",{width:120,align:"left",valign:"top",marker:{type:c("legendmarker"),width:15},values:e});break;case"top-right":this._radar.define("legend",{width:120,align:"right",valign:"top",marker:{type:c("legendmarker"),width:15},values:e});break;case"bottom-left":this._radar.define("legend",{width:120,align:"left",valign:"bottom",marker:{type:c("legendmarker"),width:15},values:e});break;case"bottom-right":this._radar.define("legend",{width:120,align:"right",valign:"bottom",marker:{type:c("legendmarker"),width:15},values:e})}}}),e});