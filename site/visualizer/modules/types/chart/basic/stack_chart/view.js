"use strict";define(["modules/default/defaultview","src/util/datatraversing","src/util/api","src/util/util","lib/flot/jquery.flot"],function(a,b,c,d){function e(){}return $.extend(!0,e.prototype,a,{init:function(){this.dom&&this.dom.empty(),this.dom||(this._id=d.getNextUniqueId(),this.dom=$('<p id="choices'+this._id+'" style="float:right; width:15%;"><br></p><div style="height: 100%;width: 80%" id="'+this._id+'"></div>'),this.module.getDomContent().html(this.dom)),this._flot&&delete this._flot,this.loadedData=$.Deferred(),this._data=[];var a,b,c=$.proxy(this.module.getConfiguration,this.module);this.updateOptions(c,a,b),this.resolveReady()},onResize:function(){var a=this;this.loadedData.done(function(){this._plot=a.plot(a._id,a._data,a._options);var b=$("#choices"+a._id);b.empty(),$.each(a._data,function(a,c){b.append("<br/><input type='checkbox' name='"+a+"' checked='checked' id='id"+a+"'></input><label for='id"+a+"'>"+c.label+"</label>")}),b.find("input").bind("click",function(c,d,e){a.plotAccordingToChoices(b,a._id)})})},update:{chart:function(a){var b=$.proxy(this.module.getConfiguration,this.module);this._convertChartToData(a.get().data);var c=a.get().axis,d=a.get().data[0].x;this.updateOptions(b,c,d),this._plot=this.plot(this._id,this._data,this._options),this.loadedData.resolve()}},_convertChartToData:function(a){if(this._data=[],Array.isArray(a)&&a&&Array.isArray(a.x))for(var b=0;b<a.length;b++){for(var c=a[b].x,d=a[b].y,e=a[b]._highlight,f=a[b].serieLabel,g=a[b].info[0].name,h=[],i=0;i<d.length;i++)$.isNumeric(c[i])?h.push({0:c[i],1:d[i],_highlight:e[i]}):h.push({0:i,1:d[i],_highlight:e[i]});this._data[b]={data:h,info:f,label:g}}},updateOptions:function(a,b,c){var d=null,e=null,f=null,g=null,h=null,i=null,j=null,k=null;if(void 0!=b){if(d=b[0].type,e=b[1].type,h=b[0].max,i=b[1].max,f=b[0].min,g=b[1].min,Array.isArray(c)){for(var l=[],m=0;m<c.length;m++)l.push([m,c[m]]);j=l}if(Array.isArray(b[1].unit)){for(l=[],m=0;m<b[1].unit.length;m++)l.push([m,b[1].unit[m]]);k=l}}var n=!1,o=!1,p=!1,q=a("stack"),r=a("barWidth"),s=a("xLabel"),t=a("yLabel"),u=a("xLabelHeight"),v=a("xLabelWidth"),w=a("yLabelHeight"),x=a("yLabelWidth");switch(a("preference")){case"Lines With Steps":n=!0,p=!0;break;case"Bars":o=!0;break;case"Lines":p=!0}this._options={xaxis:{show:!0,position:d,min:f,max:h,tickFormatter:function(a,b){return a<b.max?a.toFixed(2):s},ticks:j,labelWidth:v,labelHeight:u},yaxis:{position:e,min:g,max:i,ticks:k,tickFormatter:function(a,b){return a<b.max?a.toFixed(2):t},labelWidth:x,labelHeight:w},grid:{clickable:!0,hoverable:!0},series:{stack:q,lines:{show:p,fill:a("fill"),steps:n},bars:{show:o,barWidth:r}}}},plot:function(a,b,c){var d=this;this._plot=$.plot("#"+a,b,c),$("#"+a).bind("plotclick",function(a,b,c){a.preventDefault()}),$("#"+a).bind("plothover",function(a,b,c){c?d.module.controller.elementHover(d._data[c.seriesIndex].data[c.dataIndex]):d.module.controller.elementOut()})},plotAccordingToChoices:function(a,b){var c=this,d=[];a.find("input:checked").each(function(){var a=$(this).attr("name");a&&c._data[a]&&d.push(c._data[a])}),d.length>0&&this.plot(b,d,c._options)}}),e});