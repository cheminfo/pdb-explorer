"use strict";define(["modules/default/defaultview","src/util/util","lib/d3/d3.phylogram","src/util/api","src/util/ui","src/util/tree"],function(a,b,c,d,e,f){function g(){}function h(a,b,c){Array.isArray(c)&&(a[b]=c)}return $.extend(!0,g.prototype,a,{init:function(){this._id=b.getNextUniqueId(),this.selectorId="#"+this._id,this.chart=null,this.currentHighlightId=null,this.dom=e.getSafeElement("div").attr("id",this._id),this.module.getDomContent().html(this.dom),this.resolveReady()},blank:function(){this.dom.empty()},getIdHash:function(a){if(a.id&&(this._idHash[a.id]=a),Array.isArray(a.children))for(var b=0;b<a.children.length;b++)this.getIdHash(a.children[b])},update:{tree:function(a){this._value=a.get(),this.updateTree()},newTree:function(a){this._tree=a.get(),this.doAnnotation()},data:function(a){this._data=a.get(),this.doAnnotation()}},doAnnotation:function(){if(this._tree){var a=this.getOptions();this._value=f.annotateTree(this._tree,this._data||[],a),this.updateTree()}},updateTree:function(){this._idHash=[],this.getIdHash(this._value),d.killHighlight(this._id),this.drawPhylogram()},getOptions:function(){var a={},b=this.module.getConfiguration.bind(this.module);return h(a,"$color",b("jpathColor")),a},drawPhylogram:function(a,b){if(this._value){var e=this._value,f=this;this.dom.empty();var g=!0;e.children&&e.children.length>0&&(g=void 0===e.children[0].length),c.phylogram.build(this.selectorId,e,{height:f.height,width:f.width,skipBranchLengthScaling:g,skipTicks:!1,skipLabels:!0,children:function(a){return a.children},callbackMouseOverLeaf:function(a){f.module.controller.mouseOverLeaf(a),d.highlight(a.data,1)},callbackMouseOutLeaf:function(a){f.module.controller.mouseOutLeaf(a),d.highlight(a.data,0)},callbackClickLeaf:function(a){f.module.controller.clickLeaf(a)},callbackMouseOverBranch:function(a){f.module.controller.mouseOverBranch(a.target)},callbackMouseOutBranch:function(a){f.module.controller.mouseOutBranch(a.target)},callbackClickBranch:function(a){f.module.controller.clickBranch(a.target)}});var h=c.selectAll(this.selectorId+" .leaf");h.each(function(a){!function(a,b){a.data&&a.data._highlight&&d.listenHighlight(a.data,function(a,c){var d=b.select("circle");d.attr("fill",function(b){return b.data&&b.data.$color?b.data.$color:a?"#f5f48d":"grey"}),d.attr("r",a?9:4.5)},!1,f._id)}(a,c.select(this))}),c.selectAll(this.selectorId+" .link").each(function(){c.select(this).attr("stroke-width",f.module.getConfiguration("branchWidth")+"px"||"5px")})}},onResize:function(){this.drawPhylogram()}}),g});