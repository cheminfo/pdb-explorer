"use strict";define(["modules/default/defaultview","src/util/datatraversing","src/util/api","src/util/util","src/util/ui","lib/jit/jit-custom","src/util/tree","src/util/color"],function(a,b,c,d,e,f,g,h){function i(){}function j(a,b,c){Array.isArray(c)&&(a[b]=c)}return $.extend(!0,i.prototype,a,{highlightNode:function(a){},init:function(){this.dom||(this._id=d.getNextUniqueId(),this.dom=e.getSafeElement("div").attr("id",this._id),this.module.getDomContent().html(this.dom)),this.dom&&this.dom.empty(),this._rgraph&&delete this._rgraph,this._highlighted={},this.updateOptions(),this.resolveReady()},onResize:function(){this.createDendrogram(),this.updateDendrogram()},getIdHash:function(a){if(a.id&&(this._idHash[a.id]=a),Array.isArray(a.children))for(var b=0;b<a.children.length;b++)this.getIdHash(a.children[b])},update:{tree:function(a){this._value=$.extend(!0,new DataObject({}),a.get()),this.updateTree()},newTree:function(a){this._tree=a.get(),this.doAnnotation()},data:function(a){this._data=a.get(),this.doAnnotation()}},doAnnotation:function(){if(this._tree){var a=this.getOptions();this._value=g.annotateTree(this._tree,this._data||[],a),this.updateTree()}},updateTree:function(){if(this._idHash={},this.getIdHash(this._value),!this._rgraph){if(!document.getElementById(this._id))return;this.createDendrogram()}this.updateDendrogram()},getOptions:function(){var a={},b=this.module.getConfiguration.bind(this.module);return j(a,"$color",b("jpathColor")),j(a,"$dim",b("jpathSize")),j(a,"$type",b("jpathShape")),a},updateDendrogram:function(){this._rgraph&&this._value&&(this._rgraph.loadJSON(this._value),f.Graph.Util.each(this._rgraph.graph,function(a){a.data&&a.data.label?a.name=a.data.label:a.name=""}),this._rgraph.refresh())},updateOptions:function(){var a=$.proxy(this.module.getConfiguration,this.module);this._options={nodeSize:a("nodeSize")||1,nodeColor:h.getColor(a("nodeColor"))||"yellow"}},createDendrogram:function(){var a=this,b=this.module.vars_out();if(b&&0!=b.length){var c=function(b){a.module.controller.onHover(a._idHash[b.id])},d=$.proxy(this.module.getConfiguration,this.module);this.dom.empty();this._options;this._rgraph=new f.RGraph({injectInto:this._id,levelDistance:50,background:{CanvasStyles:{strokeStyle:h.getColor(d("strokeColor"))||"#333",lineWidth:d("strokeWidth")||"1"}},Navigation:{enable:!0,panning:!0,zooming:50},Edge:{overridable:!0,color:h.getColor(d("edgeColor"))||"green",lineWidth:d("edgeWidth")||.5},Label:{overridable:!0,type:"Native",size:d("labelSize")||10,family:"sans-serif",textAlign:"center",textBaseline:"alphabetic",color:h.getColor(d("labelColor"))||"black"},Node:{CanvasStyles:{shadowColor:"rgb(0, 0, 0)",shadowBlur:0},overridable:!0,type:d("nodeType")||"circle",color:h.getColor(d("nodeColor"))||"yellow",dim:d("nodeSize")||3,height:3,width:3,lineWidth:10},Events:{getRgraph:function(a){var b=a.srcElement.id.replace(/-.*/,"");return f.existingInstance[b]?f.existingInstance[b]:(b=a.srcElement.parentElement.id.replace(/-.*/,""),f.existingInstance[b]?f.existingInstance[b]:void 0)},enable:!0,enableForEdges:!0,type:"Native",onClick:function(a,b,c){if(a){var d,e=this.getRgraph(c);if(a.collapsed)d=a;else if(a.ignore)for(d=a.getParents()[0];d.ignore;)d=d.getParents()[0];else a.nodeFrom&&(d=a.nodeFrom._depth>a.nodeTo._depth?a.nodeFrom:a.nodeTo,a.nodeFrom.collapsed&&(d=a.nodeFrom),a.nodeTo.collapsed&&(d=a.nodeTo));d?d.collapsed?e.op.expand(d,{type:"animate",duration:1e3,hideLabels:!1,transition:f.Trans.Quart.easeInOut}):e.op.contract(a.nodeFrom,{type:"animate",duration:1e3,hideLabels:!0,transition:f.Trans.Quart.easeInOut}):a.ignore||e.onClick(a.id)}},onMouseEnter:function(a,b,d){c(a),this.getRgraph(d).canvas.getElement().style.cursor="pointer"},onMouseLeave:function(a,b,c){this.getRgraph(c).canvas.getElement().style.cursor=""}},Tips:{enable:!1}}),f.existingInstance=f.existingInstance||{},f.existingInstance[this._id]=this._rgraph}},_doHighlight:function(a,b){if((!this._highlighted[a]||!b)&&(this._highlighted[a]||b)){this._highlighted[a]=b;for(var d in this._currentValue._atoms)this._currentValue._atoms[d].indexOf(a)>-1&&c.highlight(d,b)}}}),i});