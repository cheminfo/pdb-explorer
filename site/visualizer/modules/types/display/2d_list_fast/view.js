"use strict";define(["modules/default/defaultview","src/util/typerenderer","src/util/api"],function(a,b,c){function d(){}function e(a){for(var b=a.length,c=a[0].length,d=b*c,e=new Array(d),f=0;b>f;f++)for(var g=0;c>g;g++)e[f*c+g]=a[f][g];return new DataArray(e)}return $.extend(!0,d.prototype,a,{init:function(){this.dom=$('<div class="ci-displaylist-list-2d-fast"></div>'),this.module.getDomContent().html(this.dom)},blank:{list:function(){this.list=null,c.killHighlight(this.module.getId()),this.dom.empty()},showList:function(){this.showList=null}},inDom:function(){var a=this;this.dom.on("mouseenter mouseleave click","> div",function(b){var d,e=$(this).index(),f=a.list[e];if(1===a.dim)d=[e];else{var g=Math.floor(e/a.dimWidth),h=e%a.dimWidth;d=[g,h]}"mouseenter"===b.type?(a.module.controller.setVarFromEvent("onHover","cell","list",d),c.highlight(f,1)):"mouseleave"===b.type?c.highlight(f,0):"click"===b.type&&(a.module.controller.setVarFromEvent("onClick","cell","list",d),a.module.controller.sendActionFromEvent("onClick","cell",f))}),this.resolveReady()},update:{list:function(a){var b=a.get();this.setDim(b);var c,d,f,g=this.module.getConfiguration.bind(this.module);if(1===this.dim)c=100/(g("colnumber",4)||4)+"%",d=b,f=b.length;else{var h=b[0].length;c=100/b[0].length+"%",f=b.length*h,d=e(b)}this.dataReady=new Array(f),this.dataDivs=new Array(f),this.list=d;var i=g("colorjpath",!1),j=g("valjpath",""),k={width:c},l=g("height");l&&(k.height=l+"px");for(var m=0;f>m;m++){var n=this.renderElement(this.list.getChildSync([m]),k,i,j);this.dataReady[m]=n[0],this.dataDivs[m]=n[1]}this.updateVisibility()},showList:function(a){var b=a.get();this.setDim(b),1===this.dim?this.showList=b:this.showList=e(b),this.updateVisibility()}},updateVisibility:function(){if(this.showList&&this.list){var a=this;Promise.all(this.dataReady).then(function(){for(var b=a.showList,c=0;c<b.length;c++)b[c]?a.dataDivs[c].show():a.dataDivs[c].hide()})}},renderElement:function(a,d,e,f){var g=$("<div>").css(d).appendTo(this.dom);return e&&a.getChild(e,!0).then(function(a){g.css("background-color",a.get())}),c.listenHighlight(a,function(a){a?g.css("border-color","black"):g.css("border-color","")},!1,this.module.getId()),[b.render(g,a,f),g]},setDim:function(a){var b=this.dim,c=Array.isArray(a[0])?2:1;c!==b&&(this.dim=c,this.list=null,this.showList=null),2===this.dim&&(this.dimWidth=a[0].length,this.dimHeight=a.length)}}),d});